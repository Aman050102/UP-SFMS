{% load static %}
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ title }} {{ month_label }}</title>

  <link
      rel="icon"
      href="{% static 'img/Logo_of_University_of_Phayao.svg.png' %}"
      type="image/png"
    />
    <link rel="stylesheet" href="{% static 'assets/css/global.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/admin_header.css' %}" />
  <style>
    body{margin:0;background:#f6f7fb;font-family:"Sarabun",system-ui,sans-serif}
    .bar{display:flex;gap:12px;align-items:center;padding:12px 16px;background:#5f41c5;color:#fff}
    .bar .sp{flex:1}
    .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer;transition:0.15s}
    .btn.white{background:#fff;color:#5f41c5}
    .btn.white:hover{opacity:0.9}
    .wrap{padding:12px}
    iframe{width:100%;height:calc(100vh - 64px);border:1px solid #e5e7eb;border-radius:14px;background:#fff}
  </style>
</head>
<body>
    <header class="topbar">
      <div class="brand">
        <img
          src="{% static 'img/logoDSASMART.png' %}"
          alt="DSA"
          class="brand-logo"
        />
      </div>

      <nav class="mainmenu" aria-label="‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å">
        <ul>
          <li>
            <a class="toplink" href="{% url 'staff_console' %}">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
          </li>

          <li class="has-sub">
            <a href="#" class="toplink" aria-haspopup="true">
              ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              <svg class="caret" viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M6 9l6 6 6-6"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
            </a>
            <ul class="submenu" role="menu">
              <li>
                <a role="menuitem" href="{% url 'staff_equipment' %}"
                  >‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤</a
                >
              </li>
              <li>
                <a role="menuitem" href="{% url 'staff_badminton_booking' %}"
                  >‡∏à‡∏≠‡∏á‡∏™‡∏ô‡∏≤‡∏°‡πÅ‡∏ö‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ô</a
                >
              </li>
            </ul>
          </li>

          <li class="has-sub">
            <a href="#" class="toplink" aria-haspopup="true">
              ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
              <svg class="caret" viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M6 9l6 6 6-6"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
            </a>
            <ul class="submenu" role="menu">
              <li>
                <a role="menuitem" href="{% url 'checkin_report' %}"
                  >‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏ô‡∏≤‡∏°</a
                >
              </li>
              <li>
                <a role="menuitem" href="{% url 'staff_borrow_stats' %}"
                  >‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</a
                >
              </li>
            </ul>
          </li>
        </ul>
      </nav>

      <div class="righttools">
        <span class="user-btn" aria-label="‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"
          >{{ display_name }}</span
        >
        <form action="{% url 'logout' %}" method="post" class="logout-form">
          {% csrf_token %}
          <button
            type="submit"
            class="logout"
            title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö"
            aria-label="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö"
          >
            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
          </button>
        </form>
      </div>
    </header>
  <div class="bar">
    <button class="btn white" onclick="history.back()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
    <div class="sp"><b>{{ title }} {{ month_label }}</b></div>
    <a class="btn white" href="{{ source_pdf_url }}?dl=1">‚¨áÔ∏é ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>
    <button class="btn white" id="btnPrint">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
    <button class="btn white" id="btnRegen">üîÅ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</button>
  </div>

  <div class="wrap">
    <iframe id="frame" src="{{ source_pdf_url }}" title="PDF"></iframe>
  </div>

  <script>
    const frame = document.getElementById('frame');
    document.getElementById('btnPrint').addEventListener('click', ()=>{
      const w = frame.contentWindow; if (!w) return;
      if (w.document && w.document.readyState === 'complete'){ w.focus(); w.print(); }
      else { frame.addEventListener('load', ()=>{ frame.contentWindow.focus(); frame.contentWindow.print(); }, {once:true}); }
    });
    document.getElementById('btnRegen').addEventListener('click', async (event)=>{
      const btn = event.currentTarget; btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...';
      try{
        const r = await fetch("{{ build_url }}");
        const j = await r.json();
        if (!j.ok) alert(j.message || "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        else frame.src = "{{ source_pdf_url }}" + "?t=" + Date.now(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
      }catch(e){ alert("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); }
      finally{ btn.disabled = false; btn.textContent = 'üîÅ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà'; }
    });
  </script>
</body>
</html>